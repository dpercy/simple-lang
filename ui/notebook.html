
<link rel="stylesheet"
      href="vendor/codemirror.css">
<style>
  body {
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: row;
  }
  body > .CodeMirror,
  body > #output {
    width: 50%;
    height: 100%;
    margin: 0;
  }
  
</style>


<textarea id="myTextarea">

(struct Zero 0)
(struct Succ 1)

(def one (Succ (Zero)))
(def two (Succ one))

one
(Succ one)
(Zero)

(def (plus x y)
  (match x
    [(Zero) y]
    [(Succ xx) (Succ (plus xx y))]))

(def four (plus two two))

</textarea>
<pre id="output">
</pre>




<script src="vendor/codemirror.js"></script>
<script>
  var editor = CodeMirror.fromTextArea(myTextarea, {
    lineNumbers: true
  });

  var connection = new WebSocket('ws://localhost:8001');
  connection.onopen = function(ev) {
    update();
  };
  connection.onmessage = function(ev) {
    console.log('got ev', ev);
    document.getElementById('output').innerText = ev.data;
  };

  function update() {
    var contents = editor.getValue();
    console.log('sending', contents);
    connection.send(contents);
  }

  // TODO debounce
  // TODO show most recent success, even when there's an error
  // TODO color output to show stale/freshness
  editor.on('change', update);
</script>
